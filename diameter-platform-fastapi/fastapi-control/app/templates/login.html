<!doctype html>
<html>
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="{{ url_for('static', path='css/styles.css') }}">
  <title>Login — Diameter Control</title>
</head>
<body class="centered">
  <div class="card login-card">
    <div class="brand"><div class="brand-logo">◐</div><h2>Diameter Control</h2></div>
    <form id="loginForm" class="form">
      <label>Username<input name="username" required></label>
      <label>Password<input name="password" type="password" required></label>
      <div class="form-actions">
        <button class="btn primary" type="submit">Sign in</button>
      </div>
    </form>
    <p class="muted">Use demo: admin / changeme</p>
  </div>

<script>
document.getElementById('loginForm').addEventListener('submit', async (ev) => {
  ev.preventDefault();
  const fd = new FormData(ev.target);
  const body = `username=${encodeURIComponent(fd.get('username'))}&password=${encodeURIComponent(fd.get('password'))}`;
  const res = await fetch('/api/v1/token', { method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded'}, body });
  if (!res.ok) { alert('Login failed'); return; }
  const data = await res.json();
  localStorage.setItem('auth_token', data.access_token);
  location.href = '/';
});
</script>
</body>
</html>
